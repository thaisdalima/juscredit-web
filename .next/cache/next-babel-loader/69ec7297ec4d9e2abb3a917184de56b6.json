{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport RegisterForm from \"../../../components/Register/RegisterForm\";\nimport { useState } from \"react\";\nimport ConfirmationChoice from \"../../../components/Register/ConfirmationChoice/ConfirmationChoice\";\nimport Confirmation from \"../../../components/Register/Confirmation/Confirmation\";\nimport AddressForm from \"../../../components/Register/AddressForm/AddressForm\";\nimport RegisterSuccess from \"../../../components/Register/RegisterSuccess/RegisterSuccess\";\nimport fetch from 'isomorphic-unfetch';\nimport ProducerFound from \"../../../components/Register/ProducerFound/ProducerFound\";\n\nvar UpdateProducer = function UpdateProducer(_ref) {\n  var data = _ref.data;\n  var producerId = data.id;\n\n  var _useState = useState(-1),\n      step = _useState[0],\n      setStep = _useState[1];\n\n  var _useState2 = useState(null),\n      userValues = _useState2[0],\n      setUserValues = _useState2[1];\n\n  var _useState3 = useState(null),\n      confirmationChoice = _useState3[0],\n      setConfirmationChoice = _useState3[1];\n\n  var _useState4 = useState(false),\n      invalidCode = _useState4[0],\n      setInvalid = _useState4[1];\n\n  var _useState5 = useState(false),\n      loading = _useState5[0],\n      setLoading = _useState5[1];\n\n  var handleUserSubmit = function handleUserSubmit(values) {\n    setUserValues(values);\n    setStep(1);\n  };\n\n  var handleConfimationChoice = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(choice) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setConfirmationChoice(choice);\n              _context.prev = 1;\n              setLoading(true);\n              _context.next = 5;\n              return sendConfirmation(choice);\n\n            case 5:\n              setLoading(false);\n              setStep(2);\n              _context.next = 12;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](1);\n              setLoading(false);\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 9]]);\n    }));\n\n    return function handleConfimationChoice(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleConfimation = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value) {\n      var email, phone, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              email = userValues.email, phone = userValues.phone;\n              setLoading(true);\n              _context2.prev = 2;\n              _context2.next = 5;\n              return fetch(\"\".concat(process.env.API_URL, \"/api/confirmation/verify\"), {\n                method: 'POST',\n                body: JSON.stringify({\n                  target: confirmationChoice === 'email' ? email : \"+55\".concat(phone.replace(/\\D/g, '')),\n                  code: value\n                }),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 5:\n              res = _context2.sent;\n              setLoading(false);\n\n              if (res.status === 200) {\n                setStep(3);\n              } else {\n                setInvalid(true);\n              }\n\n              _context2.next = 14;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](2);\n              setLoading(false);\n              console.log(_context2.t0);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 10]]);\n    }));\n\n    return function handleConfimation(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var sendConfirmation = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(choice) {\n      var email, phone, res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              email = userValues.email, phone = userValues.phone;\n              _context3.prev = 1;\n              _context3.next = 4;\n              return fetch(\"\".concat(process.env.API_URL, \"/api/confirmation/send-\").concat(choice), {\n                method: 'POST',\n                body: JSON.stringify(choice === 'email' ? {\n                  email: email\n                } : {\n                  phone: \"+55\".concat(phone.replace(/\\D/g, ''))\n                }),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 4:\n              res = _context3.sent;\n\n              if (!(res.status !== 200)) {\n                _context3.next = 7;\n                break;\n              }\n\n              throw res;\n\n            case 7:\n              _context3.next = 12;\n              break;\n\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3[\"catch\"](1);\n              throw _context3.t0;\n\n            case 12:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 9]]);\n    }));\n\n    return function sendConfirmation(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var handleAddressSubmit = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(values) {\n      var addressString, res, data, _data$results$0$geome, lat, lng;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              setLoading(true);\n              addressString = \"\".concat(values.address, \", \").concat(values.number, \", \").concat(values.city, \", \").concat(values.state);\n              _context4.next = 4;\n              return fetch(\"https://maps.googleapis.com/maps/api/geocode/json?address=\".concat(addressString, \"&key=AIzaSyD9birqocIzncUHjXSWIrx67UAT865gp84\"));\n\n            case 4:\n              res = _context4.sent;\n              _context4.next = 7;\n              return res.json();\n\n            case 7:\n              data = _context4.sent;\n              _data$results$0$geome = data.results[0].geometry.location, lat = _data$results$0$geome.lat, lng = _data$results$0$geome.lng;\n\n              if (!(res.status === 200)) {\n                _context4.next = 16;\n                break;\n              }\n\n              _context4.next = 12;\n              return updateProducer(_objectSpread(_objectSpread({\n                zipcode: values.zipcode,\n                address: \"\".concat(values.address, \", \").concat(values.number),\n                city: values.city,\n                state: values.state,\n                country: 'BR'\n              }, userValues), {}, {\n                latitude: lat,\n                longitude: lng\n              }));\n\n            case 12:\n              document.cookie = \"lead=\".concat(true, \"; path=/\");\n              setStep(4);\n              _context4.next = 17;\n              break;\n\n            case 16:\n              setInvalid(true);\n\n            case 17:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function handleAddressSubmit(_x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var updateProducer = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(body) {\n      var res, _data;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return fetch(\"\".concat(process.env.API_URL, \"/api/produtores/\").concat(producerId), {\n                method: 'PUT',\n                body: JSON.stringify(body),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 3:\n              res = _context5.sent;\n              _context5.next = 6;\n              return res.json();\n\n            case 6:\n              _data = _context5.sent;\n              return _context5.abrupt(\"return\", _data);\n\n            case 10:\n              _context5.prev = 10;\n              _context5.t0 = _context5[\"catch\"](0);\n              console.error(_context5.t0);\n\n            case 13:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 10]]);\n    }));\n\n    return function updateProducer(_x5) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  switch (step) {\n    case -1:\n      return __jsx(ProducerFound, {\n        producer: data,\n        onSubmit: function onSubmit() {\n          return setStep(0);\n        }\n      });\n\n    case 0:\n      return __jsx(RegisterForm, {\n        profile: \"update-producer\",\n        onSubmit: handleUserSubmit,\n        producer: data\n      });\n\n    case 1:\n      return __jsx(ConfirmationChoice, {\n        choice: confirmationChoice,\n        profile: \"producer\",\n        values: userValues,\n        onSubmit: handleConfimationChoice\n      });\n\n    case 2:\n      return __jsx(Confirmation, {\n        onSendAgain: function onSendAgain() {\n          return sendConfirmation(confirmationChoice);\n        },\n        profile: \"producer\",\n        invalid: invalidCode,\n        confirmationChoice: confirmationChoice,\n        onSubmit: handleConfimation\n      });\n\n    case 3:\n      return __jsx(AddressForm, {\n        profile: \"producer\",\n        loading: loading.toString(),\n        values: userValues,\n        producer: data,\n        onSubmit: handleAddressSubmit\n      });\n\n    case 4:\n      return __jsx(RegisterSuccess, null);\n  }\n};\n\nUpdateProducer.getInitialProps = /*#__PURE__*/function () {\n  var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_ref7) {\n    var query, id, res, data;\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            query = _ref7.query;\n            id = query.id;\n            _context6.next = 4;\n            return fetch(\"\".concat(process.env.API_URL, \"/api/produtores/\").concat(id));\n\n          case 4:\n            res = _context6.sent;\n            _context6.next = 7;\n            return res.json();\n\n          case 7:\n            data = _context6.sent;\n            return _context6.abrupt(\"return\", {\n              data: data\n            });\n\n          case 9:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function (_x6) {\n    return _ref8.apply(this, arguments);\n  };\n}();\n\nexport default UpdateProducer;","map":null,"metadata":{},"sourceType":"module"}