{"version":3,"file":"static/webpack/static\\development\\pages\\signup\\producer.js.ea36a81a3c8bf303b98e.hot-update.js","sources":["webpack:///./pages/signup/producer.tsx"],"sourcesContent":["import RegisterForm from \"../../components/Register/RegisterForm\";\r\nimport { useState, useEffect } from \"react\";\r\nimport ConfirmationChoice from \"../../components/Register/ConfirmationChoice/ConfirmationChoice\";\r\nimport Confirmation from \"../../components/Register/Confirmation/Confirmation\";\r\nimport AddressForm from \"../../components/Register/AddressForm/AddressForm\";\r\nimport RegisterSuccess from \"../../components/Register/RegisterSuccess/RegisterSuccess\";\r\nimport { useRouter } from \"next/router\";\r\nimport ProducerNotFound from \"../../components/Register/ProducerNotFound/ProducerNotFound\";\r\n\r\nconst SignupProducer = () => {\r\n    const [step, setStep] = useState(0)\r\n    const [userValues, setUserValues] = useState(null)\r\n    const [confirmationChoice, setConfirmationChoice] = useState(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [invalidCode, setInvalid] = useState(false);\r\n    const router = useRouter()\r\n\r\n\r\n    useEffect(() => {\r\n        if (router.query.notFound) {\r\n            setStep(-1);\r\n        }\r\n    }, [router.query])\r\n    const handleUserSubmit = (values) => {\r\n        setUserValues(values)\r\n        setStep(1)\r\n    }\r\n\r\n    const handleConfimationChoice = async (choice) => {\r\n        setConfirmationChoice(choice)\r\n        try {\r\n            setLoading(true)\r\n            await sendConfirmation(choice)\r\n            setLoading(false)\r\n            setStep(2)\r\n        } catch (e) {\r\n            setLoading(false)\r\n\r\n        }\r\n\r\n    }\r\n\r\n    const handleConfimation = async (value) => {\r\n        const { email, phone } = userValues;\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(`${process.env.API_URL}/api/confirmation/verify`,\r\n                {\r\n                    method: 'POST',\r\n                    body: JSON.stringify(\r\n                        {\r\n                            target: confirmationChoice === 'email' ? email : `+55${phone.replace(/\\D/g, '')}`,\r\n                            code: value\r\n                        }),\r\n                    headers: {\r\n                        'Content-Type': 'application/json'\r\n                    }\r\n\r\n                })\r\n            setLoading(false);\r\n            if (res.status === 200) {\r\n                setStep(3)\r\n            } else {\r\n                setInvalid(true);\r\n            }\r\n\r\n        } catch (e) {\r\n\r\n            setLoading(false);\r\n\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n    const handleAddressSubmit = async (values) => {\r\n        setLoading(true)\r\n        const addressString = `${values.address}, ${values.number}, ${values.city}, ${values.state}`\r\n        const { lat, lng } = data.results[0].geometry.location\r\n        if (res.status === 200) {\r\n            await createProducer({\r\n                zipcode: values.zipcode,\r\n                address: `${values.address}, ${values.number}`,\r\n                city: values.city,\r\n                state: values.state,\r\n                country: 'BR',\r\n                ...userValues,\r\n                latitude: lat,\r\n                longitude: lng\r\n            })\r\n\r\n            document.cookie = `lead=${true}; path=/`;\r\n            setStep(4)\r\n        } else {\r\n            setInvalid(true);\r\n        }\r\n    }\r\n\r\n    const sendConfirmation = async (choice) => {\r\n        const { email, phone } = userValues\r\n        try {\r\n            const res = await fetch(`${process.env.API_URL}/api/confirmation/send-${choice}`,\r\n                {\r\n                    method: 'POST',\r\n                    body: JSON.stringify(\r\n                        choice === 'email' ? {\r\n                            email\r\n                        } : {\r\n                                phone: `+55${phone.replace(/\\D/g, '')}`\r\n                            }),\r\n                    headers: {\r\n                        'Content-Type': 'application/json'\r\n                    }\r\n                })\r\n            if (res.status !== 200) {\r\n                throw res;\r\n            }\r\n        } catch (e) {\r\n            throw e\r\n        }\r\n    }\r\n    const createProducer = async (body) => {\r\n        try {\r\n            const res = await fetch(\r\n                `${process.env.API_URL}/api/produtores`,\r\n                {\r\n                    method: 'POST', body: JSON.stringify(body),\r\n                    headers: { 'Content-Type': 'application/json' }\r\n                })\r\n            const data = await res.json();\r\n\r\n            if (res.status !== 200) {\r\n                throw res.json();\r\n            }\r\n            return data;\r\n        }\r\n        catch (e) {\r\n            console.error(e)\r\n        }\r\n    }\r\n    switch (step) {\r\n        case -1:\r\n            return <ProducerNotFound onSubmit={() => setStep(0)} />\r\n        case 0:\r\n            return <RegisterForm profile=\"producer\" onSubmit={handleUserSubmit} />\r\n        case 1:\r\n            return <ConfirmationChoice choice={confirmationChoice} profile=\"producer\" values={userValues} onSubmit={handleConfimationChoice} />\r\n        case 2:\r\n            return <Confirmation onSendAgain={() => sendConfirmation(confirmationChoice)} invalid={invalidCode} profile=\"producer\" confirmationChoice={confirmationChoice} onSubmit={handleConfimation} />\r\n        case 3:\r\n            return <AddressForm profile=\"producer\" loading={loading.toString()} values={userValues} onSubmit={handleAddressSubmit} />\r\n        case 4:\r\n            return <RegisterSuccess />\r\n    }\r\n\r\n\r\n\r\n\r\n}\r\nexport default SignupProducer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAKA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AACA;AADA;AAKA;AACA;AANA;AAAA;AACA;AADA;AAAA;AAAA;AAQA;AACA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAaA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAMA;AACA;AAEA;AACA;AAFA;AAIA;AACA;AADA;AAPA;AACA;AANA;AAIA;AAaA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAvBA;AAAA;AACA;AADA;AAAA;AAAA;AA0BA;AAEA;AACA;AA7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA+BA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAMA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AARA;AACA;AANA;AAgBA;AACA;AAjBA;AAAA;AACA;AADA;AAmBA;AACA;AApBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAsBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAKA;AACA;AAEA;AADA;AAGA;AADA;AAGA;AACA;AADA;AARA;AACA;AALA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAsBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AACA;AAAA;AAAA;AAFA;AACA;AALA;AAEA;AAFA;AAAA;AACA;AADA;AAQA;AACA;AATA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAgBA;AACA;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAkBA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAZA;AAkBA;AACA;AAAA;;;;;A","sourceRoot":""}